<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Tenant Info</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f5f5f5;
      color: #222;
      text-align: center;
      padding: 30px;
    }
    h1 {
      font-size: 2.5rem;
      margin-bottom: 1rem;
    }
    input, button {
      font-size: 1.5rem;
      padding: 0.8rem;
      margin: 0.5rem 0;
      width: 90%;
      max-width: 400px;
      border: 2px solid #999;
      border-radius: 8px;
    }
    button {
      background: #0066cc;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:disabled {
      background: #999;
      cursor: not-allowed;
    }
    #result {
      margin-top: 1.5rem;
      text-align: left;
      max-width: 400px;
      margin-left: auto;
      margin-right: auto;
    }
    .card {
      background: white;
      padding: 1rem;
      margin-bottom: 1rem;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .label {
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>Tenant Info</h1>
  <button id="voiceBtn" onclick="startVoice()">ðŸŽ¤ Speak Name</button>
  <input id="textInput" type="text" placeholder="Or type name here" oninput="fetchData(this.value)">
  <div id="result"></div>

  <script>
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbw92-d9nEyBFe3ieiqa3hu_HEqWwLjer_ViZt8SVy49qeT2WSlLaJGacPSUmCsYf7p6bA/exec';

    function cleanUp() {
      const old = document.getElementById('jsonp-script');
      if (old) old.remove();
    }

    function fetchData(query) {
      cleanUp();
      document.getElementById('result').innerHTML = '';
      if (!query) return;
      const callback = 'displayResult';
      window[callback] = data => {
        displayResult(data);
        cleanUp();
      };
      const script = document.createElement('script');
      script.id  = 'jsonp-script';
      script.src = `${SCRIPT_URL}?query=${encodeURIComponent(query)}&callback=${callback}`;
      document.body.appendChild(script);
    }

    function displayResult(rows) {
      const container = document.getElementById('result');
      if (!rows || rows.length === 0) {
        container.innerHTML = '<p>No results found.</p>';
        return;
      }
      container.innerHTML = '';
      rows.forEach(r => {
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <p><span class="label">Name:</span> ${r[1]}</p>
          <p><span class="label">Address:</span> ${r[5]}</p>
          <p><span class="label">Phone:</span> ${r[7]}</p>
          <p><span class="label">Account #:</span> ${r[8]}</p>
          <p><span class="label">Holder:</span> ${r[9]}</p>
        `;
        container.appendChild(card);
      });
    }

    function startVoice() {
      if (!('webkitSpeechRecognition' in window)) {
        alert('Voice not supported. Please type.');
        return;
      }
      const rec = new webkitSpeechRecognition();
      rec.lang = 'en-IE';
      rec.onresult = e => {
        const text = e.results[0][0].transcript;
        document.getElementById('textInput').value = text;
        fetchData(text);
      };
      rec.start();
    }
  </script>
</body>
</html>
